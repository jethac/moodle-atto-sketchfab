YUI.add("moodle-atto_sketchfab-button",function(e,t){var n="atto_sketchfab",r={URLINPUT:"atto_sketchfab_urlentry"},i={URLINPUT:"."+r.URLINPUT},s='<form class="atto_form"><label for="{{elementid}}_atto_sketchfab_urlentry">{{get_string "enterurl" component}}</label><input class="fullwidth {{CSS.URLINPUT}}" type="url" id="{{elementid}}_atto_sketchfab_urlentry" size="32"/><br/><div class="mdl-align"><br/><button class="submit" type="submit">{{get_string "insertmodel" component}}</button></div></form>',o="sketchfab.com",u=480,a=300,f='<div class="sketchfab-embed"><iframe width="{{mdl.width}}" height="{{mdl.height}}" src="{{embedUrl}}" frameborder="0" allowfullscreen mozallowfullscreen="true" webkitallowfullscreen="true" onmousewheel=""></iframe><div class="sketchfab-embed-desc">{{{get_string "modeldesc" mdl.component modelname=mdl.asset author=mdl.profile sketchfab=mdl.svc }}}</div></div>';e.namespace("M.atto_sketchfab").Button=e.Base.create("button",e.M.editor_atto.EditorPlugin,[],{_currentSelection:null,_content:null,initializer:function(){this.addButton({icon:"e/insert_sketchfab",iconComponent:n,callback:this._displayDialogue})},_displayDialogue:function(){this._currentSelection=this.get("host").getSelection();if(this._currentSelection===!1)return;var e=this.getDialogue({headerContent:M.util.get_string("insertmodel",n),focusAfterHide:!0,focusOnShowSelector:i.URLINPUT});e.set("bodyContent",this._getDialogueContent()).show()},_getDialogueContent:function(){var t=e.Handlebars.compile(s);return this._content=e.Node.create(t({component:n,elementid:this.get("host").get("elementid"),CSS:r})),this._content.one(".submit").on("click",this._setModel,this),this._content},_setModel:function(t){t.preventDefault(),this.getDialogue({focusAfterHide:null}).hide();var r=t.currentTarget.ancestor(".atto_form"),s=r.one(i.URLINPUT).get("value"),l=this.get("host"),c=this,h=s!==""&&s.indexOf(o)>-1;if(h){l.setSelection(this._currentSelection);var p=s.split("/"),d=p[p.length-1];e.io(M.cfg.wwwroot+"/lib/editor/atto/plugins/sketchfab/api.php?modelid="+d,{on:{success:function(t,r){var i=e.JSON.parse(r.responseText);i.mdl={},i.mdl.component=n,i.mdl.width=u,i.mdl.height=a;var s="?utm_source=oembed&utm_medium=embed&utm_campaign="+d;i.mdl.asset='<a href="'+i.viewerUrl+s+'" target="_blank">'+i.name+"</a>",i.mdl.profile='<a href="'+i.user.profileUrl+s+'" target="_blank">'+i.user.displayName+"</a>",i.mdl.svc='<a href="https://'+o+s+'" target="_blank">Sketchfab</a>';var h=e.Handlebars.compile(f),p=e.Node.create(h(i)).getHTML();l.insertContentAtFocusPoint(p),c.markUpdated()}}})}}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});
